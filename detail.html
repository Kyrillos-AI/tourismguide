<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تفاصيل المكان | Ancient Egypt</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="map.css"> 
    
    <style>
        body { 
            overflow-y: auto; 
            overflow-x: hidden; 
            background: #050505; 
            min-height: 100vh;
        }

        /* HERO SECTION */
        .hero-section {
            height: 70vh;
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            overflow: hidden;
            border-bottom: 2px solid var(--gold);
        }
        
        .hero-bg {
            position: absolute; inset: 0;
            background-size: cover; background-position: center;
            filter: brightness(0.5);
            transform: scale(1.1);
            transition: transform 0.1s linear;
            z-index: 0;
        }

        .hero-overlay {
            position: absolute; inset: 0;
            background: linear-gradient(to top, #050505 5%, transparent 100%);
            z-index: 1;
        }

        .hero-content {
            position: relative; z-index: 2;
            text-align: center;
            padding-bottom: 40px;
            width: 100%;
        }

        .hero-title {
            font-size: 3.5rem; color: var(--gold);
            text-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
            margin-bottom: 10px;
            opacity: 0; animation: fadeUp 1s forwards 0.5s;
        }

        .hero-subtitle {
            font-size: 1.2rem; color: #ccc;
            opacity: 0; animation: fadeUp 1s forwards 0.8s;
        }

        /* FLOATING STATS */
        .stats-bar {
            display: flex; justify-content: center; gap: 20px;
            margin-top: -35px; position: relative; z-index: 5;
            flex-wrap: wrap; padding: 0 20px;
        }

        .stat-card {
            background: rgba(20, 20, 25, 0.9);
            border: 1px solid var(--gold);
            padding: 15px 25px;
            border-radius: 15px;
            text-align: center;
            min-width: 140px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transform: translateY(20px); opacity: 0;
            animation: fadeUp 1s forwards 1s;
            backdrop-filter: blur(10px);
        }

        .stat-icon { color: var(--gold); font-size: 1.2rem; margin-bottom: 5px; }
        .stat-val { color: #fff; font-weight: bold; font-size: 1rem; display: block; }
        .stat-label { color: #888; font-size: 0.8rem; }

        /* STORY SECTION */
        .details-container {
            max-width: 1000px; margin: 0 auto;
            padding: 60px 20px;
        }

        .story-section {
            display: grid; grid-template-columns: 1fr; 
            gap: 40px; margin-bottom: 80px;
        }

        .story-text h2 { color: var(--cyan); font-size: 1.8rem; margin-bottom: 20px; border-right: 4px solid var(--gold); padding-right: 15px; }
        
        .story-p { 
            font-size: 1.1rem; line-height: 1.9; color: #ddd; 
            min-height: 100px;
        }

        /* GALLERY GRID */
        .gallery-section h2 { text-align: center; color: var(--gold); margin-bottom: 30px; font-size: 2rem; }
        
        .gallery-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .gallery-item {
            height: 200px; border-radius: 10px; overflow: hidden;
            cursor: pointer; position: relative; border: 1px solid #333;
        }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; transition: 0.4s; }
        .gallery-item:hover img { transform: scale(1.1); filter: brightness(1.1); }

        /* BACK BUTTON */
        .back-btn {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            background: rgba(0,0,0,0.6); border: 1px solid var(--gold);
            color: var(--gold); width: 45px; height: 45px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; cursor: pointer; transition: 0.3s;
            text-decoration: none;
        }
        .back-btn:hover { background: var(--gold); color: #000; }
        body.english-mode .back-btn { right: auto; left: 20px; }

        @keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }
        
        /* Typing Cursor */
        .typing-cursor::after { content: '|'; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        @media(min-width: 768px) {
            .story-section { grid-template-columns: 1.5fr 1fr; align-items: start; }
            .story-image img { border-radius: 15px; border: 1px solid var(--gold); width: 100%; }
        }
    </style>
</head>
<body>

    <a href="map.html" class="back-btn"><i class="fas fa-arrow-right"></i></a>

    <header class="hero-section">
        <div class="hero-bg" id="heroBg"></div>
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <h1 class="hero-title" id="pageTitle">...</h1>
            <p class="hero-subtitle" id="pageDesc">...</p>
        </div>
    </header>

    <div class="stats-bar">
        <div class="stat-card">
            <i class="fas fa-clock stat-icon"></i>
            <span class="stat-val" id="statDate">Unknown</span>
            <span class="stat-label" data-lang="history_label">التاريخ</span>
        </div>
        <div class="stat-card">
            <i class="fas fa-map-marker-alt stat-icon"></i>
            <span class="stat-val" id="statLoc">...</span>
            <span class="stat-label" data-lang="loc_label">الموقع</span>
        </div>
        <div class="stat-card">
            <i class="fas fa-star stat-icon"></i>
            <span class="stat-val">4.9/5</span>
            <span class="stat-label" data-lang="rate_label">التقييم</span>
        </div>
    </div>

    <main class="details-container">
        <section class="story-section">
            <div class="story-text">
                <h2 data-lang="story_title">القصة والتاريخ</h2>
                <p id="longDesc" class="story-p typing-cursor"></p>
                <a href="#" class="modal-btn" style="margin-top: 20px;" data-lang="book_btn">احجز تذكرتك</a>
            </div>
            <div class="story-image">
                <img id="detailImg" src="" alt="Detail">
            </div>
        </section>

        <section class="gallery-section">
            <h2 data-lang="gallery_title">معرض الصور</h2>
            <div class="gallery-grid" id="galleryGrid"></div>
        </section>
    </main>

    <script src="map.js"></script>
   <script>
        window.addEventListener('load', () => {
            const params = new URLSearchParams(window.location.search);
            const cityId = params.get('city');
            const siteIndex = params.get('site');
            const lang = localStorage.getItem('preferredLang') || 'ar';

            // 1. Setup UI Language
            if (lang === 'en') {
                document.body.classList.add('english-mode');
                document.body.dir = 'ltr';
                document.querySelector('.back-btn i').className = "fas fa-arrow-left";
                
                // Static Labels
                document.querySelector('[data-lang="story_title"]').innerText = "History & Story";
                document.querySelector('[data-lang="gallery_title"]').innerText = "Photo Gallery";
                document.querySelector('[data-lang="book_btn"]').innerText = "Book Ticket";
                document.querySelector('[data-lang="history_label"]').innerText = "Era";
                document.querySelector('[data-lang="loc_label"]').innerText = "Location";
                document.querySelector('[data-lang="rate_label"]').innerText = "Rating";
            }

            // 2. Load Content
            if (cityId && siteIndex !== null) {
                const city = mapData.find(c => c.id === cityId);
                if (city && city.sites[siteIndex]) {
                    const site = city.sites[siteIndex];
                    const basicInfo = lang === 'ar' ? site.ar : site.en;
                    const cityInfo = lang === 'ar' ? city.content.ar : city.content.en;
                    
                    // Check if 'details' exists, otherwise use fallbacks
                    const det = site.details || { 
                        date: "Unknown", 
                        rating: "4.5", 
                        gallery: [site.img], 
                        story: { ar: basicInfo.desc + " لا تتوفر تفاصيل إضافية حالياً.", en: basicInfo.desc + " No additional details available." }
                    };

                    // Fill Header
                    document.getElementById('pageTitle').innerText = basicInfo.name;
                    document.getElementById('pageDesc').innerText = basicInfo.desc;
                    document.getElementById('heroBg').style.backgroundImage = `url('${site.img}')`;
                    document.getElementById('detailImg').src = site.img;
                    document.title = basicInfo.name;

                    // Fill Stats
                    document.getElementById('statLoc').innerText = cityInfo.title;
                    document.getElementById('statDate').innerText = det.date;
                    // Update rating visuals if you want
                    
                    // Fill Story (Typing Effect)
                    const storyText = lang === 'ar' ? det.story.ar : det.story.en;
                    typeWriter(storyText, 'longDesc');

                    // Fill Gallery
                    const galleryGrid = document.getElementById('galleryGrid');
                    // If gallery is empty or undefined, use main image
                    const galleryImages = (det.gallery && det.gallery.length > 0) ? det.gallery : [site.img, site.img, site.img];
                    
                    galleryImages.forEach((imgSrc, i) => {
                        const div = document.createElement('div');
                        div.className = 'gallery-item';
                        div.style.animation = `fadeUp 0.5s forwards ${i * 0.2}s`;
                        div.style.opacity = '0'; 
                        div.style.transform = 'translateY(20px)';
                        div.innerHTML = `<img src="${imgSrc}" loading="lazy" onerror="this.src='${site.img}'">`; // Fallback to main img if gallery link fails
                        galleryGrid.appendChild(div);
                    });
                }
            }
        });

        function typeWriter(text, elementId) {
            const el = document.getElementById(elementId);
            let i = 0;
            const speed = 15; 
            el.innerHTML = ""; // Clear first
            function type() {
                if (i < text.length) {
                    el.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                } else {
                    el.classList.remove('typing-cursor');
                }
            }
            type();
        }

        window.addEventListener('scroll', () => {
            const scroll = window.scrollY;
            const heroBg = document.getElementById('heroBg');
            if(heroBg) {
                heroBg.style.transform = `translateY(${scroll * 0.5}px) scale(1.1)`;
            }
        });
    </script>
</body>
</html>